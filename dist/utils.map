{"version":3,"sources":["utils.ts"],"names":[],"mappings":"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","file":"utils.map","sourceRoot":"../src","sourcesContent":["export function trace(clientId: string | null, title: string, value: Object | string) {\n  let prefix = '';\n  if (window.performance) {\n    prefix = '[' + (window.performance.now() / 1000).toFixed(3) + ']';\n  }\n  if (clientId) {\n    prefix = prefix + '[' + clientId + ']';\n  }\n\n  if (isEdge()) {\n    console.log(prefix + ' ' + title + '\\n', value); // eslint-disable-line\n  }\n  else {\n    console.info(prefix + ' ' + title + '\\n', value); // eslint-disable-line\n  }\n}\n\nfunction browser() {\n  const ua = window.navigator.userAgent.toLocaleLowerCase();\n  if (ua.indexOf('edge') !== -1) {\n    return 'edge';\n  }\n  else if (ua.indexOf('chrome')  !== -1 && ua.indexOf('edge') === -1) {\n    return 'chrome';\n  }\n  else if (ua.indexOf('safari')  !== -1 && ua.indexOf('chrome') === -1) {\n    return 'safari';\n  }\n  else if (ua.indexOf('opera')   !== -1) {\n    return 'opera';\n  }\n  else if (ua.indexOf('firefox') !== -1) {\n    return 'firefox';\n  }\n  return ;\n}\n\nfunction isPlanB() {\n  return browser() === 'chrome' || browser() === 'safari';\n}\n\nexport function isUnifiedChrome() {\n  if (browser() !== 'chrome') {\n    return false;\n  }\n  const ua = window.navigator.userAgent.toLocaleLowerCase();\n  const splitedUserAgent = /chrome\\/([\\d.]+)/.exec(ua);\n  if (!splitedUserAgent || splitedUserAgent.length < 2) {\n    return false;\n  }\n  return 71 <= parseInt(splitedUserAgent[1]);\n}\n\nexport function isUnifiedSafari() {\n  if (!isSafari()) {\n    return false;\n  }\n  const appVersion = window.navigator.appVersion.toLowerCase();\n  const version = /version\\/([\\d.]+)/.exec(appVersion)!.pop()!;\n  return 12.0 < parseFloat(version);\n}\n\nexport function isEdge() {\n  return browser() === 'edge';\n}\n\nexport function isSafari() {\n  return browser() === 'safari';\n}\n\nexport function isChrome() {\n  return browser() === 'chrome';\n}\n\nexport function replaceAnswerSdp(sdp: string) {\n  let ssrcPattern: RegExp | string = new RegExp(/m=video[\\s\\S]*?(a=ssrc:(\\d+)\\scname:.+\\r\\n(a=ssrc:\\2\\smsid:.+\\r\\na=ssrc:\\2\\smslabel:.+\\r\\na=ssrc:\\2\\slabel:.+\\r\\n)?)/);  // eslint-disable-line\n  const found = sdp.match(ssrcPattern);\n  if (!found) {\n    return sdp;\n  }\n\n  const ssrcAttributes = found[1];\n  ssrcPattern = found[1];\n  const ssrcId = parseInt(found[2]);\n  const ssrcIdPattern = new RegExp(ssrcId.toString(), 'g');\n  const ssrcGroup = ['a=ssrc-group:SIM'];\n  const ssrcAttributeList = [];\n  for (let i = 0; i < 3; i += 1) {\n    ssrcGroup.push((ssrcId + i).toString());\n    ssrcAttributeList.push(ssrcAttributes.replace(ssrcIdPattern, (ssrcId + i).toString()));\n  }\n  return sdp.replace(ssrcPattern, [ssrcGroup.join(' '), '\\r\\n', ssrcAttributeList.join('')].join(''));\n}\n\ninterface AudioVisualData {\n  codec_type?: never;\n  bit_rate?: never;\n}\n\ninterface SignalingMessage {\n  type: 'connect';\n  role: never;\n  channel_id: never;\n  metadata: never;\n  sdp: string;\n  userAgent: string;\n  audio: boolean | AudioVisualData;\n  video: boolean | AudioVisualData;\n  multistream?: boolean;\n  plan_b?: boolean;\n  spotlight?: never;\n  simulcast?: boolean | { quality: never };\n}\n\nexport function createSignalingMessage(offerSDP: string, role, channelId, metadata, options) {\n  const message: SignalingMessage = {\n    type: 'connect',\n    role: role,\n    channel_id: channelId,\n    metadata: metadata,\n    sdp: offerSDP,\n    userAgent: window.navigator.userAgent,\n    audio: true,\n    video: true\n  };\n  Object.keys(message).forEach(key => {\n    if (message[key] === undefined) {\n      message[key] = null;\n    }\n  });\n  if ('multistream' in options && options.multistream === true) {\n    // multistream\n    message.multistream = true;\n    if (!isUnifiedChrome() && !isUnifiedSafari() && isPlanB()) {\n      message.plan_b = true;\n    }\n    // spotlight\n    if ('spotlight' in options) {\n      message.spotlight = options.spotlight;\n    }\n  } else if ('simulcast' in options || 'simulcastQuality' in options) {\n    if (!(isUnifiedSafari() || isChrome())) {\n      throw new Error('Simulcast can not be used with this browse be used with this browserr');\n    }\n    // simulcast\n    if ('simulcast' in options && options.simulcast === true) {\n      message.simulcast = true;\n    }\n    const simalcastQualities = ['low', 'middle', 'high'];\n    if ('simulcastQuality' in options && 0 <= simalcastQualities.indexOf(options.simulcastQuality)) {\n      message.simulcast = {\n        quality: options.simulcastQuality\n      };\n    }\n  }\n  // parse options\n  const audioPropertyKeys = ['audioCodecType', 'audioBitRate'];\n  const videoPropertyKeys = ['videoCodecType', 'videoBitRate'];\n  const copyOptions = Object.assign({}, options);\n  Object.keys(copyOptions).forEach(key => {\n    if (key === 'audio' && typeof copyOptions[key] === 'boolean') return;\n    if (key === 'video' && typeof copyOptions[key] === 'boolean') return;\n    if (0 <= audioPropertyKeys.indexOf(key) && copyOptions[key] !== null) return;\n    if (0 <= videoPropertyKeys.indexOf(key) && copyOptions[key] !== null) return;\n    delete copyOptions[key];\n  });\n\n  if ('audio' in copyOptions) {\n    message.audio = copyOptions.audio;\n  }\n  const hasAudioProperty = Object.keys(copyOptions).some(key => {\n    return 0 <= audioPropertyKeys.indexOf(key);\n  });\n  if (message.audio && hasAudioProperty) {\n    message.audio = {};\n    if ('audioCodecType' in copyOptions) {\n      message.audio['codec_type'] = copyOptions.audioCodecType;\n    }\n    if ('audioBitRate' in copyOptions) {\n      message.audio['bit_rate'] = copyOptions.audioBitRate;\n    }\n  }\n\n  if ('video' in copyOptions) {\n    message.video = copyOptions.video;\n  }\n  const hasVideoProperty = Object.keys(copyOptions).some(key => {\n    return 0 <= videoPropertyKeys.indexOf(key);\n  });\n  if (message.video && hasVideoProperty) {\n    message.video = {};\n    if ('videoCodecType' in copyOptions) {\n      message.video['codec_type'] = copyOptions.videoCodecType;\n    }\n    if ('videoBitRate' in copyOptions) {\n      message.video['bit_rate'] = copyOptions.videoBitRate;\n    }\n  }\n\n  return message;\n}\n"]}